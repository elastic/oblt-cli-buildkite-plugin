services:
  plugin-lint:
    image: buildkite/plugin-linter
    command: [ '--id', 'elastic/oblt-cli' ]
    volumes:
      - ".:/plugin:ro,z"
  test:
    build:
      context: .
      dockerfile: Dockerfile
    volumes:
      - ".:/plugin:ro,z"
    command: ['bats', 'tests/unit']

  integration-test:
    build:
      context: .
      dockerfile: Dockerfile
    volumes:
      - ".:/plugin:ro,z"
    environment:
      - GH_TOKEN
      - GITHUB_TOKEN
      - VAULT_GITHUB_TOKEN
      - CI
    command: [ 'bats', 'tests/integration' ]
